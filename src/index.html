<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title></title>
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.3.2/css/bootstrap2/bootstrap-switch.css" rel="stylesheet">
        <!--<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">-->
        <link rel="stylesheet" href="bower_components/lobibox/dist/css/lobibox.min.css"/>
        <link rel="stylesheet" href="css/bootstrap.min.css">


        <script src="js/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/3.3.2/js/bootstrap-switch.js"></script>
        <script src="js/vendor/modernizr-2.8.3.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>
        <script src="bower_components/Chart.js/dist/Chart.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <script src="bower_components/lobibox/dist/js/lobibox.min.js"></script>

        <script src="js/activity.js"></script>
        <script src="js/moment-with-locales.js"></script>
        <script   src="https://code.jquery.com/jquery-1.12.3.js"   integrity="sha256-1XMpEtA4eKXNNpXcJ1pmMPs8JV+nwLdEqwiJeCQEkyc="   crossorigin="anonymous"></script>
        <script   src="https://code.jquery.com/ui/1.12.0-rc.1/jquery-ui.js"   integrity="sha256-IY2gCpIs4xnQTJzCIPlL3uUgSOwVQYD9M8t208V+7KA="   crossorigin="anonymous"></script>

        <link rel="stylesheet" href="css/main.css">


        <style>
            .filter_title {
                text-align: right;
            }
<!-- from http://www.electrictoolbox.com/jquey-make-entire-table-row-clickable/ -->
table#example {
    border-collapse: collapse;   
}
#example tr {
    background-color: #eee;
    border-top: 1px solid #fff;
}
#example tr:hover {
    background-color: #ccc;
}
#example th {
    background-color: #fff;
}
#example th, #example td {
    padding: 3px 5px;
}
#example td:hover {
    cursor: pointer;
}


        </style>
    </head>
    <body>
    <div class="container">
        <!-- Modal -->
        <div class="modal fade" id="addHistoryModal" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Add event to history</h4>
                    </div>
                    <div class="modal-body">
                        Date: <input type="text" class="form-control" name="Date"><br>
                        Time: <input type="text" class="form-control" name="Time"><br>
                        Location: <input type="text" class="form-control" name="Location"><br>
                        Difficulty: <input type="text" class="form-control" name="Difficulty"><br>
                        Add Partners: <input type="text" class="form-control" name="Add-partners"><br>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-success" id="historySubmit" data-dismiss="modal">Submit</button>
                    </div>
                </div>

            </div>
        </div>

    </div>
    <div class="container">
        <!-- Modal -->
        <div class="modal fade" id="createNewActivityModal" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Create New Event</h4>
                    </div>
                    <div class="modal-body">
                        Date: <input type="text" class="form-control" name="Date"><br>
                        Time: <input type="text" class="form-control" name="Time"><br>
                        Location: <input type="text" class="form-control" name="Location"><br>
                        Difficulty: <input type="text" class="form-control" name="Difficulty"><br>
                        Add Partners: <input type="text" class="form-control" name="Add-partners"><br>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-success" id="newEventSubmit" data-dismiss="modal">Submit</button>
                    </div>
                </div>

            </div>
        </div>

    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-4 col">
                <h1>History</h1><br>
                <button type="button" class="btn btn-info hist-button" data-toggle="modal" data-target="#addHistoryModal">Add to History</button><br>
                <input type="text" class="form-control" name="history"><br>

                <ul class="list-group history-list">

                    <li class="list-group-item" data-toggle="modal" data-target="#mymodal"><a href="#">History</a></li>
                    <li class="list-group-item" data-toggle="modal" data-target="#myModal"><a href="#">History</a></li>
                    <li class="list-group-item" data-toggle="modal" data-target="#myModal"><a href="#">History</a></li>
                    <li class="list-group-item" data-toggle="modal" data-target="#myModal"><a href="#">History</a></li>
                    <li class="list-group-item" data-toggle="modal" data-target="#myModal"><a href="#">History</a></li>

                </ul>
            </div>

            <div class="col-md-4 col" id="middle-col">
                <div id="create-new-activity-btn" class="text-center">
                    <button type="button" class="btn btn-success btn-lg" data-toggle="modal" data-target="#createNewActivityModal">Create New Activity +</button>
                </div>
                <br>
                <h2>My Upcoming Events</h2>
                <ul class="list-group history-list">

                    <li class="list-group-item"><a href="#">Activity</a></li>
                    <li class="list-group-item"><a href="#">Activity</a></li>
                    <li class="list-group-item"><a href="#">Activity</a></li>
                    <li class="list-group-item"><a href="#">Activity</a></li>
                    <li class="list-group-item"><a href="#">Activity</a></li>

                </ul>
<!--                 <iframe src="https://calendar.google.com/calendar/embed?src=en.usa%23holiday%40group.v.calendar.google.com&ctz=America/New_York" style="border: 0" width="100%" height="600" frameborder="0" scrolling="no"></iframe> -->
                <br>

                <div id="progress-bar">
                    <div class="text-center">
                        <div class="btn-group btn-toggle">
                            <button class="btn btn-default" data-toggle="collapse" data-target="#collapsible">Difficulty</button>
                            <button class="btn btn-primary active" data-toggle="collapse" data-target="#collapsible">Length</button>
                        </div>
                    </div>

                    <canvas id="myChart" width="350" height="100"></canvas>
                </div>
            </div>

            <div class="col-md-4 col">
                <h1>Posted Events</h1>

<div class="btn-group" data-toggle="buttons">
  <label class="btn" style="min-width: 160px; max-width: 160px;">Sort By</label> <!-- should not be a button-->
  <label class="btn btn-primary active">
    <input type="radio" name="options" id="option1" autocomplete="off" checked>Date
  </label>
  <label class="btn btn-primary">
    <input type="radio" name="options" id="option2" autocomplete="off">Distance
  </label>
</div>
<br>
<div class="btn-group" data-toggle="buttons">
  <label class="btn" style="min-width: 160px; max-width: 160px;">Filter Difficulty</label> <!-- should not be a button-->
  <label class="btn btn-primary active">
    <input type="radio" name="options" id="option1" autocomplete="off" checked>1
  </label>
  <label class="btn btn-primary">
    <input type="radio" name="options" id="option2" autocomplete="off">2-4
  </label>
  </label>
  <label class="btn btn-primary">
    <input type="radio" name="options" id="option2" autocomplete="off">5+
  </label>
</div>
<br>
<div class="btn-group" data-toggle="buttons">
  <label class="btn" style="min-width: 160px; max-width: 160px;">Filter Group Size</label> <!-- should not be a button-->
  <label class="btn btn-primary active">
    <input type="radio" name="options" id="option1" autocomplete="off" checked>1
  </label>
  <label class="btn btn-primary">
    <input type="radio" name="options" id="option2" autocomplete="off">2-4
  </label>
  </label>
  <label class="btn btn-primary">
    <input type="radio" name="options" id="option2" autocomplete="off">5+
  </label>
</div>
             <br><br>

             <!--<input type="text" class="form-control" name="activity"><br>-->
<table class="table" id="example">
    <thead>
      <tr>
        <th>Distance (Mi.)</th>
        <th>Date</th>
        <th>Difficulty</th>
        <th>Group Size</th>
      </tr>
    </thead>
    <tbody id="activity_right_list">
    </tbody>
</table>
                <!--<ul id="activity_right_list" class="list-group activity-list">
                    <li class="list-group-item"><a href="#">Activity</a></li>
                    <li class="list-group-item"><a href="#">Activity</a></li>
                    <li class="list-group-item"><a href="#">Activity</a></li>
                    <li class="list-group-item"><a href="#">Activity</a></li>
                    <li class="list-group-item"><a href="#">Activity</a></li>
                </ul>-->

                <div class="container-fluid">
                    <div class="row">
                          <!-- Trigger the modal with a button -->
                         <!-- <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Sign up for an event</button> -->
                          <div class="modal fade" id="myModal2" role="dialog">
                            <div class="modal-dialog modal-lg">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h4 class="modal-title">
                                        <div class="row">
                                          <div class="col-sm-4">Event host: Bob Smith</div>
                                          <div class="col-sm-4">Difficulty level: 5 </div>
                                          <div class="col-sm-4">Time: 2016-05-01 3-5 pm </div>
                                        </div>
                                  </h4>
                                </div>

                                <div class="modal-body">
                                  <div class = 'row'>
                                  <div class="col-sm-6">
                                    <h3> Location</h3>
                                    <iframe width="425" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="http://maps.google.com/maps?client=safari&q=boston+ma&oe=UTF-8&ie=UTF8&hq=&hnear=Boston&gl=us&ll=32.448377,-112.074037&spn=0.040679,0.07699&z=14&output=embed"></iframe><br /><small>
                                   </div>

                                  <div class="col-sm-4">
                                    <h3> See who is going!</h3>
                                    <img src="../Slide2.jpg" alt="participants" style="width:304px">
                                    <h3> Chat box</h3>
                                     Participate in the conversation: <input type="text" name="chat"><br>
                                    <img src="../Slide1.jpg" alt="chat_box" style="width:304px">
                                </div>
                                </div>
                                </div>

                                <div class="modal-footer">
                                  <button id="sign-up" type="button" class="btn btn-primary" data-dismiss="modal" data-backdrop="false">Sign up</button>
                                </div>
                              </div>

                          </div>

                        </div>


            </div>
        </div>
    </div>

    </body>
    <!-- Modal for Past Event Comments -->
    <div class="modal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Your Comments</h4>
          </div>
          <div class="modal-body" style="font-size:15pt;">
            <textarea style="width:500px; height:100px;"></textarea>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            <button id="save-comment" type="button" class="btn btn-primary" data-dismiss="modal" data-backdrop="false">Save</button>
          </div>
        </div>
      </div>
    </div>

</html>

<script>
$(document).ready(function(){


$("#save-comment").click(function(){
    $("#myModal").modal('hide');

    Lobibox.notify('success',{
        size: 'normal',
        rounded: 'false',
        delay: false,
        position: 'center top',
        msg: 'Comment saved!',
        sound: false,
        icon: false,
    });
});
$("#historySubmit").click(function(){
    $("#addHistoryModal").modal('hide');
    Lobibox.notify('success',{
        size: 'normal',
        rounded: 'false',
        delay: false,
        position: 'center top',
        msg: "Congratulations! You've successfully added to history!",
        sound: false,
        icon: false,
    });
});

$("#newEventSubmit").click(function(){
    $("#createNewActivityModal").modal('hide');
    Lobibox.notify('success',{
        size: 'normal',
        rounded: 'false',
        delay: false,
        position: 'center top',
        msg: "Congratulations! You've successfully added to history!",
        sound: false,
        icon: false,
    });
});

$("#sign-up").click(function(){
    $("#myModal2").modal('hide');
    Lobibox.notify('success',{
        size: 'normal',
        rounded: 'false',
        delay: false,
        position: 'center top',
        msg: "Congratulations! You've successfully sign up for the event!",
        sound: false,
        icon: false,
    });
});
        console.log("ready!");
        
        // set up dummy list of activities (for the right side)
        var activities = [];
        // TODO distance should not be part of activity
        // distance should be derived from the location name
        activities.push(new Activity("Hyannis, MA", 40, "1/2/2015", 8.5, 1));
        activities.push(new Activity("Montreal, Canada", 400, "1/5/2015", 5.5, 2));
        activities.push(new Activity("Providence, RI", 154, "1/6/2015", 4.5, 3));
        activities.push(new Activity("Cambridge, MA", 1, "1/7/2015", 3.5, 5));
        
        // this is the filteed and sorted list
        var processed_acts = activities.slice();

        // states for the filtering buttons
        // TODO SORT BY shoud start out in one of thestates 
        var SORT_BY_DATE = "date";
        var SORT_BY_DISTANCE = "distance";
        var DIFFICULTY_UNSELECTED = "unselected";
        var DIFFICULTY_A = "A";
        var DIFFICULTY_B = "B";
        var DIFFICULTY_C = "C";
        var NUMPART_UNSELECTED = "unselected";
        var NUMPART_A = "unselected";
        var NUMPART_B = "unselected";
        var NUMPART_C = "unselected";

        var sort_by = SORT_BY_DATE;
        var difficulty = DIFFICULTY_UNSELECTED;
        var numpart = NUMPART_UNSELECTED;

        distance_to_me = function(act) {
            // TODO distance should not be part of activity
            // should compute distance to user from location
            return act.dist;
        };

        render_activity_html = function(act) {
            dist = distance_to_me(act);

            return "<tr data-toggle=\"modal\" data-target=\"#myModal2\"><td>" + dist + "</td><td>" + act.datestr + "</td><td>" + act.num + "</td><td>" + act.difficulty + "</td></tr>"
        };
        
        sort_by_date = function(acts) {
            comp = function(a, b) {
                var a = moment(a.datestr).unix();
                var b = moment(b.datestr).unix();
                console.log("a:" + a);
                console.log("b:" + b);
                if (a < b) {
                    return -1;
                } else if (a == b){
                    return 0;
                } else {
                    return 1;
                }
            };
            acts.sort(comp);
        };

        sort_by_dist = function(acts) {
            comp = function(a, b) {
                var da = distance_to_me(a);
                var db = distance_to_me(b);    
                console.log("da:" + da);
                console.log("db:" + db);
                if (da < db) {
                    return -1;
                } else if (da == db){
                    return 0;
                } else {
                    return 1;
                }
            };
            acts.sort(comp);
        };

        render_list = function() {
            // copy the main list
            var processed_acts = activities.slice();
            // TODO filter and sort the list
            if (sort_by == SORT_BY_DATE) {
                sort_by_date(processed_acts);
            } else if (sort_by == SORT_BY_DISTANCE) {
                sort_by_dist(processed_acts);
            } else {
                console.log("error unrecognized sort_by" + sort_by);
            }
            // write the html
            $("#activity_right_list").empty();
            for (var i=0; i < processed_acts.length; i++) {
                act = processed_acts[i];
                console.log(act);
                $("#activity_right_list").append(render_activity_html(act));
            }
        };

        // TODO re-render the button states
        $("#sort_by_date").click(function() {
            sort_by = SORT_BY_DATE;
            render_list();
        });

        $("#sort_by_dist").click(function() {
            sort_by = SORT_BY_DISTANCE;
            render_list();
        });

        render_list();

    });
        
var ctx = document.getElementById("myChart").getContext("2d");

var data = {
    labels: ["January", "February", "March", "April", "May", "June", "July"],
    datasets: [
        {
            label: "",
            fillColor: "rgba(220,220,220,0.5)",
            strokeColor: "rgba(220,220,220,0.8)",
            highlightFill: "rgba(220,220,220,0.75)",
            highlightStroke: "rgba(220,220,220,1)",
            data: [65, 59, 80, 81, 56, 55, 40]
        },
    ]
};

var myBarChart = new Chart(ctx, {
    type: 'bar',
    data: data,
});

$('.btn-toggle').click(function() {
    $(this).find('.btn').toggleClass('active');

    if ($(this).find('.btn-primary').size()>0) {
        $(this).find('.btn').toggleClass('btn-primary');
    }
    if ($(this).find('.btn-danger').size()>0) {
        $(this).find('.btn').toggleClass('btn-danger');
    }
    if ($(this).find('.btn-success').size()>0) {
        $(this).find('.btn').toggleClass('btn-success');
    }
    if ($(this).find('.btn-info').size()>0) {
        $(this).find('.btn').toggleClass('btn-info');
    }

    $(this).find('.btn').toggleClass('btn-default');
});

</script>
